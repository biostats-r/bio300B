<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Assignment 1 feedback</title>
    <meta charset="utf-8" />
    <meta name="author" content="Richard J. Telford (Richard.Telford@uib.no)" />
    <meta name="date" content="2021-09-21" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/default-fonts.css" rel="stylesheet" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Assignment 1 feedback
## Bio300B
### Richard J. Telford (<a href="mailto:Richard.Telford@uib.no" class="email">Richard.Telford@uib.no</a>)
### Institutt for biovitenskap, UiB
### 21 September 2021

---






```r
#activate the package
library(tidyverse)

#import file into object
biomass &lt;- read_delim(file = "data/biomass2015_H.csv",     
                    delim = ",")

#tidy data
biomass_long &lt;- biomass |&gt;
  pivot_longer(cols = H1:H10, 
               names_to = "height", 
               values_to = "value",
               values_drop_na = TRUE)

#mean height with 10 or more observations
biomass_mean_height &lt;- biomass_long |&gt;                     
  group_by(species) |&gt; 
  filter(n() &gt;= 10) |&gt; 
  summarise(mean_height = mean(value)) |&gt; 
  arrange(desc(mean_height))
```
---
# Result


```
## # A tibble: 27 × 2
##    species               mean_height
##    &lt;chr&gt;                       &lt;dbl&gt;
##  1 Kobresia cercostachys        6.12
##  2 Kobresia.sp1                 5.25
##  3 Deyeuxia pulchella           5.11
##  4 Kobresia.sp4                 4.38
##  5 Festuca forrestii            3.81
##  6 Kobresia pygmaea             3.76
##  7 Allium prattii               3.50
##  8 Aletris pauciflora           2.71
##  9 Astragalus skythropos        2.19
## 10 Galearis spathulata          2.13
## # … with 17 more rows
```


---
# Downloading the data

In browser "file" &gt; "save as" or with


```r
download.file(url =  "https://raw.githubusercontent.com/biostats-r/biostats/main/WorkingInR/data/biomass2015_H.csv", 
              destfile = "data/biomass2015_H.csv")
```

---

# Importing the data


```r
biomass &lt;- read_delim(file = "data/biomass2015_H.csv", delim = ",") # best

read.delim() # not ideal
# Use Rstudio projects with relative paths
setwd("___") # bad idea
read_csv("my drive/Biostatistics/datalab 2/biomass2015_H.csv") # bad idea
file.choose() # very bad idea - need to find the file every time
```
 
---
# pivot longer


```r
# very hard to do without pivot longer
biomass %&gt;%
  drop_na(H1:H10) %&gt;% 
  group_by(species) %&gt;% 
  summarise(mean_value = mean(H1:H10))
```

```
## Warning in H1:H10: numerical expression has 4 elements: only the
## first used

## Warning in H1:H10: numerical expression has 4 elements: only the
## first used
```

```
## Warning in H1:H10: numerical expression has 9 elements: only the
## first used

## Warning in H1:H10: numerical expression has 9 elements: only the
## first used
```

```
## Warning in H1:H10: numerical expression has 7 elements: only the
## first used

## Warning in H1:H10: numerical expression has 7 elements: only the
## first used
```

```
## Warning in H1:H10: numerical expression has 11 elements: only
## the first used

## Warning in H1:H10: numerical expression has 11 elements: only
## the first used
```

```
## Warning in H1:H10: numerical expression has 5 elements: only the
## first used

## Warning in H1:H10: numerical expression has 5 elements: only the
## first used
```

```
## Warning in H1:H10: numerical expression has 3 elements: only the
## first used

## Warning in H1:H10: numerical expression has 3 elements: only the
## first used
```

```
## Warning in H1:H10: numerical expression has 10 elements: only
## the first used

## Warning in H1:H10: numerical expression has 10 elements: only
## the first used
```

```
## Warning in H1:H10: numerical expression has 9 elements: only the
## first used

## Warning in H1:H10: numerical expression has 9 elements: only the
## first used
```

```
## Warning in H1:H10: numerical expression has 5 elements: only the
## first used

## Warning in H1:H10: numerical expression has 5 elements: only the
## first used
```

```
## Warning in H1:H10: numerical expression has 13 elements: only
## the first used

## Warning in H1:H10: numerical expression has 13 elements: only
## the first used
```

```
## Warning in H1:H10: numerical expression has 7 elements: only the
## first used

## Warning in H1:H10: numerical expression has 7 elements: only the
## first used
```

```
## Warning in H1:H10: numerical expression has 13 elements: only
## the first used

## Warning in H1:H10: numerical expression has 13 elements: only
## the first used
```

```
## Warning in H1:H10: numerical expression has 12 elements: only
## the first used

## Warning in H1:H10: numerical expression has 12 elements: only
## the first used
```

```
## Warning in H1:H10: numerical expression has 3 elements: only the
## first used

## Warning in H1:H10: numerical expression has 3 elements: only the
## first used
```

```
## Warning in H1:H10: numerical expression has 11 elements: only
## the first used

## Warning in H1:H10: numerical expression has 11 elements: only
## the first used
```

```
## Warning in H1:H10: numerical expression has 5 elements: only the
## first used

## Warning in H1:H10: numerical expression has 5 elements: only the
## first used
```

```
## Warning in H1:H10: numerical expression has 8 elements: only the
## first used

## Warning in H1:H10: numerical expression has 8 elements: only the
## first used
```

```
## Warning in H1:H10: numerical expression has 3 elements: only the
## first used

## Warning in H1:H10: numerical expression has 3 elements: only the
## first used
```

```
## Warning in H1:H10: numerical expression has 5 elements: only the
## first used

## Warning in H1:H10: numerical expression has 5 elements: only the
## first used
```

```
## # A tibble: 23 × 2
##    species                 mean_value
##    &lt;chr&gt;                        &lt;dbl&gt;
##  1 "Allium prattii"               4.9
##  2 "Androsace minor "             0.8
##  3 "Aster asteroides"             1.3
##  4 "Cyananthus incanus"           1.8
##  5 "Deyeuxia pulchella"           3.9
##  6 "Festuca forrestii"            4  
##  7 "Galearis spathulata"          2.9
##  8 "Gentiana crassula"            1.5
##  9 "Kobresia cercostachys"        6  
## 10 "Kobresia pygmaea"             5.2
## # … with 13 more rows
```

 
---
# Removing the NA

Must be done in or after pivot_longer()


```r
biomass %&gt;%   
  drop_na(H1:H10) %&gt;%      #Remove all NA values
  pivot_longer(cols = H1:H10, names_to = "Height", values_to = "value") |&gt; 
  summarise(n = n())
```

```
## # A tibble: 1 × 1
##       n
##   &lt;int&gt;
## 1  1470
```

```r
biomass %&gt;%   
  pivot_longer(cols = H1:H10, names_to = "Height", values_to = "value") |&gt; 
  drop_na(value) |&gt; 
  summarise(n = n())
```

```
## # A tibble: 1 × 1
##       n
##   &lt;int&gt;
## 1  1948
```

---
##  values_drop_na

```r
mb &lt;- microbenchmark::microbenchmark(
  IN =  biomass |&gt;
  pivot_longer(cols = H1:H10, 
               names_to = "height", 
               values_to = "value",
               values_drop_na = TRUE),
 AFTER = biomass |&gt;
  pivot_longer(cols = H1:H10, 
               names_to = "height", 
               values_to = "value") |&gt; 
  drop_na(value)
)

mb
```

```
## Unit: milliseconds
##   expr      min       lq     mean   median       uq      max
##     IN 5.963722 6.402430 6.965052 6.633404 7.212562 12.21805
##  AFTER 8.372465 8.770329 9.744383 9.073976 9.608567 23.10777
##  neval
##    100
##    100
```

---

```r
autoplot(mb)
```

![](assignment1-feedback_files/figure-html/unnamed-chunk-9-1.png)&lt;!-- --&gt;


---
# filter fun



```r
Biomass_long |&gt; drop_na(value) # easiest - best
Biomass_long |&gt; filter(!is.na(value)) # good


Biomass_long |&gt; filter(value != "NA") # accidentally works
Biomass_long |&gt; filter(value &gt;= 0) # accidentally works

Biomass_long |&gt; na.omit() # dangerous
```


---
# dropping rare taxa

`n()`
or `add_count()` AFTER `group_by()`


```r
# with mutate
biomass_long |&gt; 
  group_by(species) |&gt;  
  mutate(n = n()) |&gt;  
  filter(n&lt; 10)
```

```
## # A tibble: 28 × 20
## # Groups:   species [9]
##    site  plot  size      记录名称 中名  species cover production
##    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;    &lt;lgl&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;     
##  1 H     I-2   50cm*50cm 报春     NA    Primul…   0.9 "0.0318 " 
##  2 H     I-2   50cm*50cm 报春     NA    Primul…   0.9 "0.0318 " 
##  3 H     I-4   50cm*50cm 草莓     NA    Fragar…   0.8  &lt;NA&gt;     
##  4 H     I-4   50cm*50cm 草莓     NA    Fragar…   0.8  &lt;NA&gt;     
##  5 H     I-3   50cm*50cm 抽葶藁本 NA    Ligust…   1.2 "0.4523 " 
##  6 H     I-3   50cm*50cm 抽葶藁本 NA    Ligust…   1.2 "0.4523 " 
##  7 H     I-5   50cm*50cm 抽葶藁本 NA    Ligust…   1.2 "0.2078 " 
##  8 H     I-12  50cm*50cm 抽葶藁本 NA    Ligust…   1.1 "0.1996 " 
##  9 H     I-1   50cm*50cm 灯芯草   NA    Juncus…   0.2 "0.0202 " 
## 10 H     I-1   50cm*50cm 灯芯草   NA    Juncus…   0.2 "0.0202 " 
## # … with 18 more rows, and 12 more variables:
## #   investigator &lt;chr&gt;, recorder &lt;chr&gt;, time &lt;chr&gt;,
## #   Total cover(%) &lt;dbl&gt;, AH1 &lt;dbl&gt;, AH2 &lt;dbl&gt;, AH3 &lt;dbl&gt;,
## #   AH4 &lt;dbl&gt;, AH5 &lt;dbl&gt;, height &lt;chr&gt;, value &lt;dbl&gt;, n &lt;int&gt;
```

```r
# one step
biomass_long |&gt; 
  group_by(species) |&gt;  
  filter(n() &lt; 10)
```

```
## # A tibble: 28 × 19
## # Groups:   species [9]
##    site  plot  size      记录名称 中名  species cover production
##    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;    &lt;lgl&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;     
##  1 H     I-2   50cm*50cm 报春     NA    Primul…   0.9 "0.0318 " 
##  2 H     I-2   50cm*50cm 报春     NA    Primul…   0.9 "0.0318 " 
##  3 H     I-4   50cm*50cm 草莓     NA    Fragar…   0.8  &lt;NA&gt;     
##  4 H     I-4   50cm*50cm 草莓     NA    Fragar…   0.8  &lt;NA&gt;     
##  5 H     I-3   50cm*50cm 抽葶藁本 NA    Ligust…   1.2 "0.4523 " 
##  6 H     I-3   50cm*50cm 抽葶藁本 NA    Ligust…   1.2 "0.4523 " 
##  7 H     I-5   50cm*50cm 抽葶藁本 NA    Ligust…   1.2 "0.2078 " 
##  8 H     I-12  50cm*50cm 抽葶藁本 NA    Ligust…   1.1 "0.1996 " 
##  9 H     I-1   50cm*50cm 灯芯草   NA    Juncus…   0.2 "0.0202 " 
## 10 H     I-1   50cm*50cm 灯芯草   NA    Juncus…   0.2 "0.0202 " 
## # … with 18 more rows, and 11 more variables:
## #   investigator &lt;chr&gt;, recorder &lt;chr&gt;, time &lt;chr&gt;,
## #   Total cover(%) &lt;dbl&gt;, AH1 &lt;dbl&gt;, AH2 &lt;dbl&gt;, AH3 &lt;dbl&gt;,
## #   AH4 &lt;dbl&gt;, AH5 &lt;dbl&gt;, height &lt;chr&gt;, value &lt;dbl&gt;
```

```r
# with summarise (very hard)
biomass_long |&gt; 
  group_by(species) |&gt;  
  summarise(n = n()) |&gt;  
  filter(n&lt; 10)
```

```
## # A tibble: 9 × 2
##   species                                    n
##   &lt;chr&gt;                                  &lt;int&gt;
## 1 "Agrostis"                                 1
## 2 "Fragaria orientalis"                      2
## 3 "Gentiana trichotoma "                     3
## 4 "Halenia elliptica"                        1
## 5 "Juncus leucomelas"                        6
## 6 "Ligusticum scapiforme"                    4
## 7 "Pedicularis.sp"                           4
## 8 "Primula amethystina subsp.argutidens"     2
## 9 "Rhodiola bupleuroides"                    5
```

---


```r
#gjsnitt høyde til de med mer enn 10 
summarise(group_by(biomass_long, species),
          mean(value, na.rm= TRUE)) %&gt;% 
  filter(species != ("Agrostis")) %&gt;% 
  filter(species != ("Fragaria orientalis")) %&gt;% 
  filter(species != ("Gentiana trichotoma ")) %&gt;%  
  filter(species != ("Halenia elliptica")) %&gt;%  
  filter(species != ("Juncus leucomelas")) %&gt;%  
  filter(species != ("Ligusticum scapiforme")) %&gt;%  
  filter(species != ("Pedicularis.sp")) %&gt;% 
  filter(species != ("Primula amethystina subsp.argutidens")) %&gt;% 
  filter(species != ("mix")) %&gt;% 
  filter(species != ("Rhodiola bupleuroides"))
```

```
## # A tibble: 27 × 2
##    species                 `mean(value, na.rm = TRUE)`
##    &lt;chr&gt;                                         &lt;dbl&gt;
##  1 "Aletris pauciflora"                          2.71 
##  2 "Allium prattii"                              3.50 
##  3 "Androsace minor "                            0.960
##  4 "Anemone demissa"                             1.96 
##  5 "Aster asteroides"                            1.21 
##  6 "Astragalus skythropos"                       2.19 
##  7 "Cyananthus incanus"                          1.28 
##  8 "Deyeuxia pulchella"                          5.11 
##  9 "Festuca forrestii"                           3.81 
## 10 "Galearis spathulata"                         2.13 
## # … with 17 more rows
```

---
# select()?


```r
mb &lt;- microbenchmark::microbenchmark(
  BEFORE =  biomass |&gt; 
  select(species, H1:H10) |&gt; 
  pivot_longer(cols = H1:H10, 
               names_to = "height", 
               values_to = "value"),
 AFTER = biomass |&gt;
  pivot_longer(cols = H1:H10, 
               names_to = "height", 
               values_to = "value") |&gt; 
  select(species, value)
)

mb
```

```
## Unit: milliseconds
##    expr      min       lq     mean   median       uq      max
##  BEFORE 7.586168 8.182230 8.922233 8.414800 8.853026 20.17953
##   AFTER 8.444252 8.812511 9.419956 9.106535 9.604901 20.47007
##  neval
##    100
##    100
```



---
# comments

- long comments at ends of lines are difficult to read.
- Put long comments on line before code

---
# weeds

Remove unused code


```r
# All the height column which have 10 readings (removed all NA)
View(height_all)
names(height_all)
str(height_all)
height_all_long &lt;- height_all |&gt; pivot_longer(cols = H1:H10, names_to = "heights", values_to = "height")
view(height_all_long)
```

---
# Missing code

include all code necessary to reproduce result

- library()
- import code


---
# pipes

new line after every pipe.


```r
# Difficult to read without pipes
summarise(group_by(biomass, species), mean = mean(height, na.rm = TRUE))
```



    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
